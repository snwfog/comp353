// Generated by CoffeeScript 1.3.3

$(function() {
  var noteAlert, recallTime;
  recallTime = 2000;
  setInterval(function() {
    return $.ajax({
      url: "index.php?ajax&notify_acquire=1",
      dataType: "json"
    }).done(function(data) {
      if (data != null) {
        return $.each(data, function(i, item) {
          return noteAlert("Your bid \"<b><a href=\"index.php?offer&id=" + item.id + "\">" + item.title + "</a></b>\"            just arrived at the garage. You may come and pick it up            during our regular business hour within the next <b>14</b> days.", "success");
        });
      }
    });
  }, recallTime);
  setInterval(function() {
    return $.ajax({
      url: "index.php?ajax&notify_expired_bids=1",
      dataType: "json"
    }).done(function(data) {
      if (data != null) {
        return $.each(data, function(i, item) {
          return noteAlert(("Your bids \"<b><a href=\"index.php?offer&id=" + item.id + "\">" + item.description + "</a></b>\"          was expired <b>") + moment(item.date, "YYYY-MM-DD").fromNow() + "</b>.", "warning");
        });
      }
    });
  }, recallTime);
  setInterval(function() {
    return $.ajax({
      url: "index.php?ajax&notify_receive=1",
      dataType: "json"
    }).done(function(data) {
      if (data != null) {
        return $.each(data, function(i, item) {
          return noteAlert("Hey, we just received your item \"<b><a href=\"index.php?offer&id=" + item.id + "\">" + item.title + "</a></b>\"            in our garage. Rest assured as we've already notified            the bidder to come and pick it up.", "success");
        });
      }
    });
  }, recallTime);
  setInterval(function() {
    return $.ajax({
      url: "index.php?ajax&notify_modify=1",
      dataType: "json"
    }).done(function(data) {
      if (data != null) {
        return $.each(data, function(i, item) {
          return noteAlert("The item \"<b><a href=\"index.php?offer&id=" + item.id + "\">" + item.title + "</a></b>\"                      has been modified by the owner.", "warning");
        });
      }
    });
  }, recallTime);
  $.ajax({
    url: "index.php?ajax&is_admin=1",
    dataType: "json"
  }).done(function(data) {
    if (data != null) {
      if (data.is_admin != null) {
        return noteAlert("Hey <b>" + data.admin_username + "</b>,          you are now in <b>Rainbow Unicorn Mode</b>            AKA <b>Admin Mode</b>.", "success");
      }
    }
  });
  noteAlert = function(msg, type) {
    var n;
    return n = noty({
      layout: 'bottomRight',
      type: type,
      text: msg,
      animation: {
        open: {
          height: 'toggle'
        },
        close: {
          height: 'toggle'
        },
        easing: 'swing',
        speed: 200
      }
    });
  };
  return $('#member-name').keyup(function() {
    return $.ajax({
      url: "index.php?ajax&admin_member_search=" + $(this).val(),
      dataType: "json"
    }).done(function(data) {
      if (data != null) {
        $('#member-search-table').html("<tr><th>User</th><th>Posts</th>          <th>Buys</th><th>Sells</th><th>Rating</th></tr>");
        return $.each(data, function(i, item) {
          return $('#member-search-table').append("<tr>" + "<td><div class='tiptip'>" + "<a href='index.php?member&id=" + item.id + "' class='button'>" + "<span class='icon icon191'>" + "</span><span class='label'>" + item.username + "</span></a></div></td>" + ("<td>" + item.posts + "</td>") + ("<td>" + item.buys + "</td>") + ("<td>" + item.sells + "</td>") + "<td>" + (item.rating === null ? "No Rating" : item.rating + "</td></tr>"));
        });
      }
    });
  });
});
